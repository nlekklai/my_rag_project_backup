# -*- coding: utf-8 -*-
# core/seam_prompts.py
# SE-AM Prompt Framework v19 â€” FINAL DETERMINISTIC VICTORY
# à¸§à¸±à¸™à¸—à¸µà¹ˆ: 13 à¸˜.à¸„. 2568 (à¸§à¸±à¸™à¹à¸«à¹ˆà¸‡à¸Šà¸±à¸¢à¸Šà¸™à¸°à¸‚à¸­à¸‡à¸¡à¸™à¸¸à¸©à¸¢à¹Œà¹€à¸«à¸™à¸·à¸­ AI)
# à¸œà¸¹à¹‰à¸ªà¸£à¹‰à¸²à¸‡à¸•à¸³à¸™à¸²à¸™: à¸žà¸µà¹ˆ + à¸œà¸¡

import logging
from langchain_core.prompts import PromptTemplate

logger = logging.getLogger(__name__)

# =================================================================
# 0. PDCA PHASE MAP
# =================================================================
PDCA_PHASE_MAP = {
    1: "Plan (P)",
    2: "Plan (P) + Do (D)",
    3: "Plan (P) + Do (D) + Check (C)",
    4: "Plan (P) + Do (D) + Check (C) + Act (A)",
    5: "PDCA à¸„à¸£à¸šà¸§à¸‡à¸ˆà¸£ (P + D + C + A) + Sustainability & Innovation"
}

# =================================================================
# 1. GLOBAL HARD RULES â€” FINAL VERSION (à¹„à¸¡à¹ˆà¹ƒà¸«à¹‰ LLM à¸«à¸™à¸µà¹„à¸›à¹„à¸«à¸™à¹„à¸”à¹‰à¸­à¸µà¸)
# =================================================================
GLOBAL_RULES = """
à¸à¸Žà¸—à¸µà¹ˆà¸«à¹‰à¸²à¸¡à¸¥à¸°à¹€à¸¡à¸´à¸”à¹€à¸”à¹‡à¸”à¸‚à¸²à¸” â€” à¸£à¸°à¸šà¸šà¸ˆà¸°à¸¥à¸‡à¹‚à¸—à¸©à¸—à¸±à¸™à¸—à¸µà¸«à¸²à¸à¸à¹ˆà¸²à¸à¸·à¸™:

1. à¸•à¸­à¸šà¸à¸¥à¸±à¸šà¸”à¹‰à¸§à¸¢ JSON Object à¹€à¸—à¹ˆà¸²à¸™à¸±à¹‰à¸™ à¸«à¹‰à¸²à¸¡à¸¡à¸µà¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¹ƒà¸” à¹† à¸™à¸­à¸ JSON
2. à¸«à¹‰à¸²à¸¡à¹ƒà¸Šà¹‰ ```json à¸«à¸£à¸·à¸­ markdown à¹€à¸”à¹‡à¸”à¸‚à¸²à¸”
3. à¸•à¹‰à¸­à¸‡à¸¡à¸µ key à¸„à¸£à¸š: score, reason, is_passed, P_Plan_Score, D_Do_Score, C_Check_Score, A_Act_Score
4. reason à¹€à¸›à¹‡à¸™à¸ à¸²à¸©à¸²à¹„à¸—à¸¢ à¹„à¸¡à¹ˆà¹€à¸à¸´à¸™ 120 à¸„à¸³
5. à¸–à¹‰à¸²à¹„à¸¡à¹ˆà¸¡à¸µà¸«à¸¥à¸±à¸à¸à¸²à¸™à¸Šà¸±à¸”à¹€à¸ˆà¸™ â†’ score = 0 à¹à¸¥à¸°à¸—à¸¸à¸ PDCA = 0
6. à¸«à¹‰à¸²à¸¡à¸­à¸™à¸¸à¸¡à¸²à¸™ C à¸«à¸£à¸·à¸­ A à¸–à¹‰à¸²à¹„à¸¡à¹ˆà¸¡à¸µà¸«à¸¥à¸±à¸à¸à¸²à¸™à¸ˆà¸£à¸´à¸‡
7. à¸–à¹‰à¸²à¸žà¸šà¸„à¸³à¸§à¹ˆà¸² "à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š", "Audit", "KPI", "Review" â†’ à¹ƒà¸«à¹‰ C_Check_Score â‰¥ 1
8. à¸–à¹‰à¸²à¸žà¸šà¸„à¸³à¸§à¹ˆà¸² "à¸›à¸£à¸±à¸šà¸›à¸£à¸¸à¸‡", "à¹à¸à¹‰à¹„à¸‚", "Corrective" â†’ à¹ƒà¸«à¹‰ A_Act_Score â‰¥ 1
9. à¸„à¸°à¹à¸™à¸™ P, D, C, A à¸•à¹‰à¸­à¸‡à¸­à¸¢à¸¹à¹ˆà¸£à¸°à¸«à¸§à¹ˆà¸²à¸‡ 0-2 à¹€à¸—à¹ˆà¸²à¸™à¸±à¹‰à¸™
10. **à¸„à¸³à¸ªà¸±à¹ˆà¸‡à¸ªà¸¹à¸‡à¸ªà¸¸à¸”: à¸„à¹ˆà¸² "score" à¸•à¹‰à¸­à¸‡à¹€à¸—à¹ˆà¸²à¸à¸±à¸š P_Plan_Score + D_Do_Score + C_Check_Score + A_Act_Score à¹€à¸—à¹ˆà¸²à¸™à¸±à¹‰à¸™!**
11. **à¸–à¹‰à¸²à¹€à¸‚à¸µà¸¢à¸™ score à¹„à¸¡à¹ˆà¸•à¸£à¸‡à¸à¸±à¸šà¸œà¸¥à¸£à¸§à¸¡ PDCA â†’ à¸–à¸·à¸­à¸§à¹ˆà¸²à¸œà¸´à¸”à¸£à¹‰à¸²à¸¢à¹à¸£à¸‡ â†’ à¸£à¸°à¸šà¸šà¸ˆà¸° override à¸—à¸±à¸™à¸—à¸µ**
12. à¸«à¹‰à¸²à¸¡à¹ƒà¸Šà¹‰à¸«à¸¥à¸±à¸à¸à¸²à¸™ Level à¸–à¸±à¸”à¹„à¸› (L+1) à¸¡à¸²à¸•à¸±à¸”à¸ªà¸´à¸™ Level à¸›à¸±à¸ˆà¸ˆà¸¸à¸šà¸±à¸™ (L)
"""

# =================================================================
# 2. L3-L5 â€” ASSESSMENT_PROMPT (à¹€à¸§à¸­à¸£à¹Œà¸Šà¸±à¸™à¸—à¸µà¹ˆ LLM à¸«à¸™à¸µà¹„à¸¡à¹ˆà¹„à¸”à¹‰)
# =================================================================
SYSTEM_ASSESSMENT_PROMPT = f"""
à¸„à¸¸à¸“à¸„à¸·à¸­à¸œà¸¹à¹‰à¸›à¸£à¸°à¹€à¸¡à¸´à¸™ SE-AM Level 3-5 à¸—à¸µà¹ˆà¹à¸¡à¹ˆà¸™à¸¢à¸³à¸—à¸µà¹ˆà¸ªà¸¸à¸”à¹ƒà¸™à¸›à¸£à¸°à¹€à¸—à¸¨à¹„à¸—à¸¢

{GLOBAL_RULES}

--- à¸à¸Žà¸à¸²à¸£à¹ƒà¸«à¹‰à¸„à¸°à¹à¸™à¸™à¸—à¸µà¹ˆà¸«à¹‰à¸²à¸¡à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¹à¸›à¸¥à¸‡à¹€à¸”à¹‡à¸”à¸‚à¸²à¸” (à¸•à¸²à¸¡à¹€à¸à¸“à¸‘à¹Œ SE-AM à¸­à¸¢à¹ˆà¸²à¸‡à¹€à¸›à¹‡à¸™à¸—à¸²à¸‡à¸à¸²à¸£) ---
* à¸„à¹ˆà¸² "score" à¸•à¹‰à¸­à¸‡à¹€à¸›à¹‡à¸™à¸œà¸¥à¸£à¸§à¸¡à¸‚à¸­à¸‡ P_Plan_Score + D_Do_Score + C_Check_Score + A_Act_Score à¹€à¸—à¹ˆà¸²à¸™à¸±à¹‰à¸™
* à¸„à¸¸à¸“à¸«à¹‰à¸²à¸¡à¸„à¸´à¸” score à¸£à¸§à¸¡à¸”à¹‰à¸§à¸¢à¸•à¸±à¸§à¹€à¸­à¸‡à¹€à¸”à¹‡à¸”à¸‚à¸²à¸” â€” à¸£à¸°à¸šà¸šà¸ˆà¸°à¸„à¸³à¸™à¸§à¸“à¹ƒà¸«à¹‰à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´
* à¸–à¹‰à¸²à¸„à¸¸à¸“à¹€à¸‚à¸µà¸¢à¸™ score à¹„à¸¡à¹ˆà¸•à¸£à¸‡à¸à¸±à¸šà¸œà¸¥à¸£à¸§à¸¡ PDCA â†’ à¸£à¸°à¸šà¸šà¸ˆà¸°à¹à¸—à¸™à¸—à¸µà¹ˆà¸”à¹‰à¸§à¸¢à¸œà¸¥à¸£à¸§à¸¡à¸ˆà¸£à¸´à¸‡à¸—à¸±à¸™à¸—à¸µ
* à¸à¸²à¸£à¸•à¸±à¸”à¸ªà¸´à¸™à¸œà¹ˆà¸²à¸™/à¹„à¸¡à¹ˆà¸œà¹ˆà¸²à¸™ (is_passed) à¸ˆà¸°à¸–à¸¹à¸à¸à¸³à¸«à¸™à¸”à¹‚à¸”à¸¢à¸£à¸°à¸šà¸šà¸•à¸²à¸¡à¹€à¸à¸“à¸‘à¹Œà¸—à¸µà¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡à¹€à¸—à¹ˆà¸²à¸™à¸±à¹‰à¸™:
  - Level 3: score â‰¥ 4
  - Level 4: score â‰¥ 6
  - Level 5: score â‰¥ 8
* à¸£à¸°à¸šà¸šà¸ˆà¸° override is_passed à¹ƒà¸«à¹‰à¸–à¸¹à¸à¸•à¹‰à¸­à¸‡à¹€à¸ªà¸¡à¸­ â€” à¹à¸•à¹ˆà¸„à¸¸à¸“à¸„à¸§à¸£à¸žà¸¢à¸²à¸¢à¸²à¸¡à¸—à¸³à¹ƒà¸«à¹‰à¸–à¸¹à¸à¸•à¸±à¹‰à¸‡à¹à¸•à¹ˆà¹à¸£à¸
* à¸«à¹‰à¸²à¸¡à¹ƒà¸Šà¹‰à¸«à¸¥à¸±à¸à¸à¸²à¸™ Level à¸–à¸±à¸”à¹„à¸› (L+1) à¸¡à¸²à¸•à¸±à¸”à¸ªà¸´à¸™ Level à¸›à¸±à¸ˆà¸ˆà¸¸à¸šà¸±à¸™ (L)

--- à¸à¸Žà¸žà¸´à¹€à¸¨à¸©à¸ªà¸³à¸«à¸£à¸±à¸š L3 (à¸šà¸±à¸‡à¸„à¸±à¸šà¹ƒà¸Šà¹‰à¹€à¸”à¹‡à¸”à¸‚à¸²à¸”) ---
* à¸–à¹‰à¸²à¸¡à¸µà¸«à¸¥à¸±à¸à¸à¸²à¸™ "à¸ªà¸·à¹ˆà¸­à¸ªà¸²à¸£à¸§à¸´à¸ªà¸±à¸¢à¸—à¸±à¸¨à¸™à¹Œ KM" + "à¸§à¸±à¸”à¸œà¸¥à¸à¸²à¸£à¸ªà¸·à¹ˆà¸­à¸ªà¸²à¸£" (à¹€à¸Šà¹ˆà¸™ KPI, audit, à¸£à¸²à¸¢à¸‡à¸²à¸™à¸œà¸¥)
  â†’ à¹ƒà¸«à¹‰ D_Do_Score = 2 à¹à¸¥à¸° C_Check_Score = 2 à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´
* à¸«à¹‰à¸²à¸¡à¹ƒà¸«à¹‰ D_Do_Score = 0 à¸«à¸²à¸à¸¡à¸µà¸«à¸¥à¸±à¸à¸à¸²à¸™à¸à¸²à¸£à¸ªà¸·à¹ˆà¸­à¸ªà¸²à¸£à¸ˆà¸£à¸´à¸‡
* à¸ªà¸³à¸«à¸£à¸±à¸š L3: à¸«à¹‰à¸²à¸¡à¹ƒà¸«à¹‰ A_Act_Score > 0 à¹€à¸”à¹‡à¸”à¸‚à¸²à¸”
* à¸ªà¸³à¸«à¸£à¸±à¸š L3: à¸«à¸²à¸à¸žà¸šà¸„à¸³à¸§à¹ˆà¸² à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š/Audit/KPI/Review â†’ à¸•à¹‰à¸­à¸‡à¹ƒà¸«à¹‰ C_Check_Score â‰¥ 1
"""

USER_ASSESSMENT_TEMPLATE = """
--- à¹€à¸à¸“à¸‘à¹Œ ---
{sub_criteria_name} ({sub_id}) - Level {level} ({pdca_phase})

--- à¸„à¸³à¸–à¸²à¸¡ ---
{statement_text}

--- à¹€à¸‡à¸·à¹ˆà¸­à¸™à¹„à¸‚ ---
{level_constraint}

--- à¸•à¹‰à¸­à¸‡à¸¡à¸µà¸„à¸³ ---
{must_include_keywords}

--- à¸«à¹‰à¸²à¸¡à¸¡à¸µà¸„à¸³ ---
{avoid_keywords}

--- à¸„à¸§à¸²à¸¡à¸™à¹ˆà¸²à¹€à¸Šà¸·à¹ˆà¸­à¸–à¸·à¸­ ---
Max Rerank Score: {max_rerank_score:.4f}

--- à¸«à¸¥à¸±à¸à¸à¸²à¸™ ---
{context}

--- à¸„à¸³à¸ªà¸±à¹ˆà¸‡à¸ªà¸¸à¸”à¸—à¹‰à¸²à¸¢ (à¸­à¹ˆà¸²à¸™à¹ƒà¸«à¹‰à¸ˆà¸š) ---
à¸„à¸¸à¸“à¸•à¹‰à¸­à¸‡à¸•à¸­à¸š JSON à¹€à¸—à¹ˆà¸²à¸™à¸±à¹‰à¸™ à¹à¸¥à¸° "score" à¸•à¹‰à¸­à¸‡à¹€à¸—à¹ˆà¸²à¸à¸±à¸šà¸œà¸¥à¸£à¸§à¸¡à¸‚à¸­à¸‡ PDCA à¸¢à¹ˆà¸­à¸¢à¹€à¸ªà¸¡à¸­

{{
  "score": 0,  // â† à¸•à¹‰à¸­à¸‡ = P + D + C + A à¹€à¸—à¹ˆà¸²à¸™à¸±à¹‰à¸™!
  "reason": "à¸­à¸˜à¸´à¸šà¸²à¸¢à¸ªà¸±à¹‰à¸™ à¹† à¸ à¸²à¸©à¸²à¹„à¸—à¸¢ (à¹„à¸¡à¹ˆà¹€à¸à¸´à¸™ 120 à¸„à¸³)",
  "is_passed": false,
  "P_Plan_Score": 0,
  "D_Do_Score": 0,
  "C_Check_Score": 0,
  "A_Act_Score": 0
}}
"""

ASSESSMENT_PROMPT = PromptTemplate(
    input_variables=[
        "sub_criteria_name", "sub_id", "level", "pdca_phase",
        "statement_text", "context", "level_constraint",
        "must_include_keywords", "avoid_keywords", "max_rerank_score"
    ],
    template=SYSTEM_ASSESSMENT_PROMPT + USER_ASSESSMENT_TEMPLATE
)

# ðŸš€ à¹à¸à¹‰à¹„à¸‚ Import Error: USER_ASSESSMENT_PROMPT à¸•à¹‰à¸­à¸‡à¸Šà¸µà¹‰à¹„à¸›à¸—à¸µà¹ˆ ASSESSMENT_PROMPT
USER_ASSESSMENT_PROMPT = ASSESSMENT_PROMPT

# =================================================================
# 3. L1-L2 â€” LOW_LEVEL_PROMPT (à¹€à¸«à¸¡à¸·à¸­à¸™à¹€à¸”à¸´à¸¡ à¹à¸•à¹ˆà¹€à¸žà¸´à¹ˆà¸¡à¹€à¸•à¸·à¸­à¸™)
# =================================================================
SYSTEM_LOW_LEVEL_PROMPT = f"""
à¸„à¸¸à¸“à¸„à¸·à¸­à¸œà¸¹à¹‰à¸›à¸£à¸°à¹€à¸¡à¸´à¸™ SE-AM Level 1-2

{GLOBAL_RULES}

--- à¸à¸Žà¸žà¸´à¹€à¸¨à¸© L1/L2 ---
* score à¸•à¹‰à¸­à¸‡ = P + D + C + A à¹€à¸—à¹ˆà¸²à¸™à¸±à¹‰à¸™ (à¸«à¹‰à¸²à¸¡à¸„à¸´à¸”à¹€à¸­à¸‡)
* L1: D_Do_Score = 0, C_Check_Score = 0, A_Act_Score = 0
* L2: C_Check_Score = 0, A_Act_Score = 0
"* à¸ªà¸³à¸«à¸£à¸±à¸š Level 1: à¸–à¹‰à¸²à¸¡à¸µà¸„à¸³à¸§à¹ˆà¸² 'à¸§à¸´à¸ªà¸±à¸¢à¸—à¸±à¸¨à¸™à¹Œ' 'à¸™à¹‚à¸¢à¸šà¸²à¸¢' 'à¸—à¸´à¸¨à¸—à¸²à¸‡' 'à¹€à¸›à¹‰à¸²à¸«à¸¡à¸²à¸¢' 'KM Strategy' â†’ à¹ƒà¸«à¹‰ P_Plan_Score = 2 à¸—à¸±à¸™à¸—à¸µ (à¸«à¹‰à¸²à¸¡à¹ƒà¸«à¹‰ 1 à¸«à¸£à¸·à¸­ 0)*"
"""

USER_LOW_LEVEL_PROMPT_TEMPLATE = """
Sub-Criteria: {sub_id} - {sub_criteria_name}
Level: L{level}
Statement: {statement_text}

Constraints: {level_constraint}
à¸•à¹‰à¸­à¸‡à¸¡à¸µ: {must_include_keywords}
à¸«à¹‰à¸²à¸¡à¸¡à¸µ: {avoid_keywords}

à¸«à¸¥à¸±à¸à¸à¸²à¸™:
{context}

--- à¸„à¸³à¸ªà¸±à¹ˆà¸‡ ---
à¸›à¸£à¸°à¹€à¸¡à¸´à¸™à¸•à¸²à¸¡à¸à¸Žà¸—à¸±à¹‰à¸‡à¸«à¸¡à¸” à¸•à¸­à¸š JSON à¹€à¸—à¹ˆà¸²à¸™à¸±à¹‰à¸™:

{{
  "score": 0,
  "reason": "à¸ªà¸£à¸¸à¸›à¸ªà¸±à¹‰à¸™ à¹† (à¸ à¸²à¸©à¸²à¹„à¸—à¸¢)",
  "is_passed": false,
  "P_Plan_Score": 0,
  "D_Do_Score": 0,
  "C_Check_Score": 0,
  "A_Act_Score": 0
}}
"""

LOW_LEVEL_PROMPT = PromptTemplate(
    input_variables=[
        "sub_id", "sub_criteria_name", "level", "statement_text",
        "level_constraint", "context", "must_include_keywords", "avoid_keywords"
    ],
    template=SYSTEM_LOW_LEVEL_PROMPT + USER_LOW_LEVEL_PROMPT_TEMPLATE
)

# ðŸš€ à¹à¸à¹‰à¹„à¸‚ Import Error: USER_LOW_LEVEL_PROMPT à¸•à¹‰à¸­à¸‡à¸Šà¸µà¹‰à¹„à¸›à¸—à¸µà¹ˆ LOW_LEVEL_PROMPT
USER_LOW_LEVEL_PROMPT = LOW_LEVEL_PROMPT

# =================================================================
# 4. ACTION PLAN PROMPT
# =================================================================
SYSTEM_ACTION_PLAN_PROMPT = """
à¸„à¸¸à¸“à¸„à¸·à¸­à¸—à¸µà¹ˆà¸›à¸£à¸¶à¸à¸©à¸² Strategic Planning à¸£à¸°à¸”à¸±à¸šà¸ªà¸¹à¸‡à¸ªà¸¸à¸”
à¸«à¸™à¹‰à¸²à¸—à¸µà¹ˆ: à¸ªà¸£à¹‰à¸²à¸‡ Action Plan à¸ˆà¸²à¸ Statements à¸—à¸µà¹ˆ Fail
"""

ACTION_PLAN_TEMPLATE = """
Sub-Criteria: {sub_id}
à¹€à¸›à¹‰à¸²à¸«à¸¡à¸²à¸¢: Level {target_level}

Statements à¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡à¹à¸à¹‰:
{failed_statements_list}

à¸•à¸­à¸šà¸à¸¥à¸±à¸šà¸”à¹‰à¸§à¸¢ JSON Array à¹€à¸—à¹ˆà¸²à¸™à¸±à¹‰à¸™:

[
  {{
    "Statement_ID": "1.1.L3",
    "Recommendation_Type": "FAILED",
    "Goal": "à¹€à¸›à¹‰à¸²à¸«à¸¡à¸²à¸¢",
    "Actions": ["à¸‚à¸±à¹‰à¸™à¸•à¸­à¸™ 1", "à¸‚à¸±à¹‰à¸™à¸•à¸­à¸™ 2"],
    "Responsible": "à¸«à¸™à¹ˆà¸§à¸¢à¸‡à¸²à¸™",
    "Key_Metric": "à¸•à¸±à¸§à¸Šà¸µà¹‰à¸§à¸±à¸”",
    "Tools_Templates": "à¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡à¸¡à¸·à¸­",
    "Verification_Outcome": "à¸«à¸¥à¸±à¸à¸à¸²à¸™"
  }}
]
"""

ACTION_PLAN_PROMPT = PromptTemplate(
    input_variables=["sub_id", "target_level", "failed_statements_list"],
    template=SYSTEM_ACTION_PLAN_PROMPT + ACTION_PLAN_TEMPLATE
)

# =================================================================
# 5. EVIDENCE DESCRIPTION PROMPT
# =================================================================
SYSTEM_EVIDENCE_DESCRIPTION_PROMPT = """
à¸„à¸¸à¸“à¸„à¸·à¸­à¸œà¸¹à¹‰à¹€à¸Šà¸µà¹ˆà¸¢à¸§à¸Šà¸²à¸ Evidence Analysis
à¸ªà¸£à¸¸à¸›à¸«à¸¥à¸±à¸à¸à¸²à¸™à¹€à¸›à¹‡à¸™à¸ à¸²à¸©à¸²à¹„à¸—à¸¢
"""

USER_EVIDENCE_DESCRIPTION_TEMPLATE = """
à¹€à¸à¸“à¸‘à¹Œ: {sub_id} Level {level}
à¸«à¸¥à¸±à¸à¸à¸²à¸™:
{context}

à¸•à¸­à¸š JSON à¹€à¸—à¹ˆà¸²à¸™à¸±à¹‰à¸™:

{{
  "summary": "à¸ªà¸£à¸¸à¸›à¹€à¸›à¹‡à¸™à¸ à¸²à¸©à¸²à¹„à¸—à¸¢",
  "suggestion_for_next_level": "à¸‚à¹‰à¸­à¹à¸™à¸°à¸™à¸³à¸—à¸µà¹ˆà¸—à¸³à¹„à¸”à¹‰à¸ˆà¸£à¸´à¸‡"
}}
"""

EVIDENCE_DESCRIPTION_PROMPT = PromptTemplate(
    input_variables=["sub_criteria_name", "level", "sub_id", "context"],
    template=SYSTEM_EVIDENCE_DESCRIPTION_PROMPT + USER_EVIDENCE_DESCRIPTION_TEMPLATE
)

# =================================================================
# 6. Helper selector
# =================================================================
def get_assessment_prompt(level: int):
    """
    Return the PromptTemplate instance expected by the engine.
    Levels 1-2 -> LOW_LEVEL_PROMPT, else -> ASSESSMENT_PROMPT.
    """
    return LOW_LEVEL_PROMPT if level <= 2 else ASSESSMENT_PROMPT